# iOS App - Backend Integration

## Overview
The iOS React Native app is now fully integrated with the FastAPI backend. All tasks are stored in PostgreSQL and automatically labeled by AI using GPT-4 and Pinecone.

## What Was Done

### 1. Dependencies Installed
- `axios` - HTTP client for API communication

### 2. Files Created
- `src/config/api.ts` - API configuration (base URL, endpoints)
- `src/services/api.ts` - Complete API service with all backend operations

### 3. App.tsx Updated
- Added backend integration with async/await
- Tasks now load from backend on app start
- All CRUD operations (Create, Read, Update, Delete) connected to API
- Loading states and error handling added
- User-friendly alerts for success/error states

### 4. iOS Configuration
- Info.plist already configured with `NSAllowsLocalNetworking: true`
- Allows localhost connections for development

## How It Works

### Task Creation Flow
1. User creates task in iOS app
2. Task sent to backend via POST `/api/v1/tasks`
3. Backend stores in PostgreSQL
4. Background worker starts AI labeling (GPT-4)
5. Labels stored with confidence scores
6. Embeddings created and stored in Pinecone

### Task Loading
- App loads all tasks from backend on startup
- Shows loading spinner during fetch
- Displays error alert if backend is unreachable

### Task Updates
- Toggle completion status: PUT `/api/v1/tasks/{id}`
- Delete tasks: DELETE `/api/v1/tasks/{id}`
- All changes sync immediately with backend

## Running the App

### Start Backend (Terminal 1)
```bash
cd backend
source venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Start iOS App (Terminal 2)
```bash
npm run ios
# or
npx react-native run-ios
```

### For Android
The API config automatically uses `10.0.2.2:8000` for Android emulator.

## API Endpoints Used

- `GET /health` - Health check
- `GET /api/v1/tasks/` - List all tasks
- `GET /api/v1/tasks/{id}` - Get single task
- `POST /api/v1/tasks/` - Create new task
- `PUT /api/v1/tasks/{id}` - Update task
- `DELETE /api/v1/tasks/{id}` - Delete task
- `GET /api/v1/labels/task/{id}` - Get task labels
- `GET /api/v1/labels/task/{id}/status` - Check labeling status

## Testing

Backend is verified working:
- Health check: ✅ `{"status":"healthy"}`
- Tasks endpoint: ✅ Returns empty task list
- Task creation: ✅ Task ID 1 created successfully

## Network Configuration

### iOS Simulator
- Uses `http://localhost:8000`
- Works out of the box with `NSAllowsLocalNetworking`

### Android Emulator
- Uses `http://10.0.2.2:8000`
- 10.0.2.2 is the special IP for host machine

### Physical Devices
- Replace with your computer's IP address in `src/config/api.ts`
- Example: `http://192.168.1.100:8000`
- Make sure backend runs on `0.0.0.0` (not 127.0.0.1)

## Features Enabled

1. **Persistent Storage** - Tasks saved to PostgreSQL database
2. **AI Labeling** - Automatic smart labels generated by GPT-4
3. **Semantic Search** - Vector embeddings stored in Pinecone
4. **Real-time Sync** - All operations immediately reflected in backend
5. **Error Handling** - User-friendly error messages and alerts
6. **Loading States** - Smooth UX with loading indicators

## Next Steps

### Optional Enhancements
1. **Pull to Refresh** - Add swipe-down refresh functionality
2. **View Labels** - Show AI-generated labels in UI
3. **Search/Filter** - Search tasks by labels or content
4. **Offline Mode** - Queue changes when offline
5. **Push Notifications** - Notify when labeling completes

### View Labels Example
You can fetch labels for a task:
```typescript
const labels = await apiService.getTaskLabels(taskId);
console.log(labels); // Array of Label objects with categories and confidence
```

## Troubleshooting

### "Cannot connect to backend"
1. Make sure backend is running: `curl http://localhost:8000/health`
2. Check backend logs for errors
3. Verify CORS settings in backend `.env`

### "Network request failed"
1. Check Info.plist has `NSAllowsLocalNetworking: true`
2. Verify iOS simulator can reach localhost
3. Try restarting the Metro bundler

### Backend Errors
1. Check PostgreSQL is running: `docker ps`
2. Verify API keys in backend `.env`
3. Check backend logs for detailed errors

## Architecture

```
iOS App (React Native)
    ↓
API Service (axios)
    ↓
FastAPI Backend (Python)
    ├── PostgreSQL (Tasks Storage)
    ├── GPT-4 (AI Labeling)
    └── Pinecone (Vector Search)
```

## Success Indicators

When everything works:
- ✅ App loads without errors
- ✅ Tasks persist after app restart
- ✅ Backend logs show API requests
- ✅ Creating tasks shows success alert
- ✅ Database contains task records

Backend startup should show:
```
✓ Pinecone index 'task-recommendations' created successfully
Database tables created successfully!
INFO: Uvicorn running on http://0.0.0.0:8000
INFO: Application startup complete.
```
