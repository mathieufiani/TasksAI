runtime: python311
service: default

instance_class: F1

entrypoint: uvicorn app.main:app --host 0.0.0.0 --port 8080

env_variables:
  APP_NAME: "TasksAI - Production"
  APP_VERSION: "1.0.0"
  DEBUG: "False"
  API_V1_PREFIX: "/api/v1"
  BACKEND_CORS_ORIGINS: '["*"]'

  # Database - Using SQLite in /tmp for now (data is temporary - resets on instance restart)
  # TODO: Migrate to Cloud SQL PostgreSQL for persistent storage
  DATABASE_URL: "sqlite:////tmp/tasksai.db"
  DATABASE_ECHO: "False"

  # OpenAI - Set in GitHub Secrets
  # OPENAI_API_KEY: will be set via environment variables
  OPENAI_MODEL: "gpt-4o-mini"
  OPENAI_EMBEDDING_MODEL: "text-embedding-3-small"

  # Pinecone - Set in GitHub Secrets
  # PINECONE_API_KEY: will be set via environment variables
  PINECONE_INDEX_NAME: "task-recommendations"
  PINECONE_NAMESPACE: "default"
  PINECONE_CLOUD: "aws"
  PINECONE_REGION: "us-east-1"

automatic_scaling:
  target_cpu_utilization: 0.65
  min_instances: 0
  max_instances: 5
  min_pending_latency: 30ms
  max_pending_latency: automatic
  max_concurrent_requests: 50

handlers:
- url: /.*
  script: auto
  secure: always
  redirect_http_response_code: 301
