runtime: python311
service: default

instance_class: F4

entrypoint: uvicorn app.main:app --host 0.0.0.0 --port 8080 --workers 4

env_variables:
  APP_NAME: "Task Management API"
  APP_VERSION: "1.0.0"
  DEBUG: "False"
  API_V1_PREFIX: "/api/v1"
  BACKEND_CORS_ORIGINS: '["https://yourapp.com","https://www.yourapp.com"]'

  # Database - Replace with your Cloud SQL or external database URL
  DATABASE_URL: "postgresql://user:password@/dbname?host=/cloudsql/project:region:instance"
  DATABASE_ECHO: "False"

  # OpenAI - Set in GitHub Secrets
  # OPENAI_API_KEY: will be set via environment variables
  OPENAI_MODEL: "gpt-4"
  OPENAI_EMBEDDING_MODEL: "text-embedding-3-small"

  # Pinecone - Set in GitHub Secrets
  # PINECONE_API_KEY: will be set via environment variables
  PINECONE_INDEX_NAME: "task-recommendations-prod"
  PINECONE_NAMESPACE: "production"
  PINECONE_CLOUD: "aws"
  PINECONE_REGION: "us-east-1"

automatic_scaling:
  target_cpu_utilization: 0.65
  min_instances: 2
  max_instances: 10
  min_pending_latency: 30ms
  max_pending_latency: automatic
  max_concurrent_requests: 80

handlers:
- url: /.*
  script: auto
  secure: always
  redirect_http_response_code: 301
