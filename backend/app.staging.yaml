runtime: python311
service: default

instance_class: F2

entrypoint: uvicorn app.main:app --host 0.0.0.0 --port 8080

env_variables:
  APP_NAME: "Task Management API - Staging"
  APP_VERSION: "1.0.0"
  DEBUG: "False"
  API_V1_PREFIX: "/api/v1"
  BACKEND_CORS_ORIGINS: '["https://staging.yourapp.com","http://localhost:3000","http://localhost:8081"]'

  # Database - Cloud SQL PostgreSQL
  DATABASE_URL: "postgresql://postgres:TasksAI2025SecurePassword@/tasksdb?host=/cloudsql/tasksai-474818:us-central1:tasksai-db"
  DATABASE_ECHO: "False"

  # OpenAI
  OPENAI_API_KEY: "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"
  OPENAI_MODEL: "gpt-4"
  OPENAI_EMBEDDING_MODEL: "text-embedding-3-small"

  # Pinecone
  PINECONE_API_KEY: "pcsk_5H7MDW_MPzHqwrdcxAfvE2aZ79GtXM7hqiFys5vit2hnGKC3RNjbdUjSSLipApQy4uDFts"
  PINECONE_INDEX_NAME: "task-recommendations-staging"
  PINECONE_NAMESPACE: "staging"
  PINECONE_CLOUD: "aws"
  PINECONE_REGION: "us-east-1"

automatic_scaling:
  target_cpu_utilization: 0.65
  min_instances: 1
  max_instances: 5
  min_pending_latency: 30ms
  max_pending_latency: automatic
  max_concurrent_requests: 50

handlers:
- url: /.*
  script: auto
  secure: always
  redirect_http_response_code: 301
