runtime: python311
service: staging

instance_class: F2

entrypoint: uvicorn app.main:app --host 0.0.0.0 --port 8080

env_variables:
  APP_NAME: "Task Management API - Staging"
  APP_VERSION: "1.0.0"
  DEBUG: "False"
  API_V1_PREFIX: "/api/v1"
  BACKEND_CORS_ORIGINS: '["https://staging.yourapp.com","http://localhost:3000","http://localhost:8081"]'

  # Database - Replace with your Cloud SQL or external database URL
  DATABASE_URL: "postgresql://user:password@/dbname?host=/cloudsql/project:region:instance"
  DATABASE_ECHO: "False"

  # OpenAI - Set in GitHub Secrets
  # OPENAI_API_KEY: will be set via environment variables
  OPENAI_MODEL: "gpt-4"
  OPENAI_EMBEDDING_MODEL: "text-embedding-3-small"

  # Pinecone - Set in GitHub Secrets
  # PINECONE_API_KEY: will be set via environment variables
  PINECONE_INDEX_NAME: "task-recommendations-staging"
  PINECONE_NAMESPACE: "staging"
  PINECONE_CLOUD: "aws"
  PINECONE_REGION: "us-east-1"

automatic_scaling:
  target_cpu_utilization: 0.65
  min_instances: 1
  max_instances: 5
  min_pending_latency: 30ms
  max_pending_latency: automatic
  max_concurrent_requests: 50

handlers:
- url: /.*
  script: auto
  secure: always
  redirect_http_response_code: 301
